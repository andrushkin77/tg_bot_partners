<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><title>Мой профиль</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  body { background:#161616;color:#fff;font-family:Arial;padding:20px;}
  .container{max-width:500px;margin:auto;background:#1e1e1e;padding:20px;border-radius:10px;position:relative;}
  label{display:block;margin-top:10px;}
  input,textarea{width:100%;background:#292929;color:#fff;border:none;border-radius:5px;padding:10px;}
  button{margin-top:15px;padding:10px;width:49%;border:none;border-radius:5px;cursor:pointer;}
  #editBtn{background:#FFA500;color:#000;}#saveBtn{background:#32CD32;color:#fff;}
</style>
</head><body>
<div class="container">
  <h2>Мой профиль</h2>
  <label>Название</label><input id="name" disabled>
  <label>Описание</label><textarea id="description" rows="3" disabled></textarea>
  <label>Адрес</label><input id="address" disabled>
  <label>Город</label><input id="city" disabled>
  <label>Карта</label><input id="map_link" disabled>
  <label>VK</label><input id="vk_link" disabled>
  <label>Telegram</label><input id="tg_link" disabled>
  <div style="display:flex;justify-content:space-between;">
    <button id="editBtn">Изменить данные</button>
    <button id="saveBtn" style="display:none;">Сохранить</button>
  </div>
  <button onclick="history.back()">Вернуться</button>
</div>
<script>
  const ws = Telegram.WebApp; ws.expand();
  const p = new URLSearchParams(location.search),
        pid = p.get('partner_id'),
        api = 'https://xxxm53-169-150-209-165.ru.tuna.am/api';
  // Загрузка данных
  fetch(`${api}/partners/${pid}`).then(r=>r.json()).then(d=>{
    const c=d.partner;
    name.value=c.name;description.value=c.description;
    address.value=c.address;city.value=c.city;
    map_link.value=c.map_link;vk_link.value=c.vk_link;
    tg_link.value=c.tg_link;
  });
  // Редактирование
  editBtn.onclick = ()=>{
    [name,description,address,city,map_link,vk_link,tg_link]
      .forEach(el=>el.disabled=false);
    editBtn.style.display='none'; saveBtn.style.display='inline-block';
  };
  saveBtn.onclick = ()=>{
    const payload = {
      id: pid,
      name: name.value,
      description: description.value,
      address: address.value,
      city: city.value,
      map_link: map_link.value,
      vk_link: vk_link.value,
      tg_link: tg_link.value
    };
    fetch(`${api}/update_partner`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    })
    .then(r=>r.json()).then(_=>{
      alert('Сохранено');
      location.reload();
    });
  };
</script>
</body></html>
