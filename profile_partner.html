<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8">
<title>Карточка партнёра</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
 body{background:#161616;color:#fff;font-family:Arial;padding:20px}
 #back{background:none;border:none;color:#32CD32;font-size:18px;
       text-decoration:underline;cursor:pointer;margin-bottom:10px}
 h2{text-align:center;margin-bottom:10px}
 label{display:block;margin-top:10px}
 input,textarea{width:100%;background:#292929;color:#fff;border:none;border-radius:5px;padding:10px}
 .row{display:flex;justify-content:space-between;margin-top:20px}
 button{width:48%;padding:12px;border:none;border-radius:6px;cursor:pointer;font-weight:bold}
 .edit{background:#FFA500;color:#000}.save{background:#32CD32;color:#fff}
</style></head><body>
<button id="back">← Назад</button>
<h2>Карточка партнёра</h2>

<label>Название</label><input id="name" disabled>
<label>Описание</label><textarea id="description" rows="3" disabled></textarea>
<label>Адрес</label><input id="address" disabled>
<label>Город</label><input id="city" disabled>
<label>Ссылка на карту</label><input id="map_link" disabled>
<label>VK</label><input id="vk_link" disabled>
<label>Telegram</label><input id="tg_link" disabled>

<div class="row">
  <button id="edit" class="edit">Изменить</button>
  <button id="save" class="save" style="display:none">Сохранить</button>
</div>

<script>
 const api = 'https://ib52b2-169-150-209-165.ru.tuna.am/api';
 const tg  = Telegram.WebApp; tg.expand();
 const pid = new URLSearchParams(location.search).get('partner_id');

 /* загрузка */
 fetch(`${api}/partners/${pid}`)
  .then(r=>r.json()).then(d=>{
     const p=d.partner;
     name.value=p.name||''; description.value=p.description||'';
     address.value=p.address||''; city.value=p.city||'';
     map_link.value=p.map_link||''; vk_link.value=p.vk_link||'';
     tg_link.value=p.tg_link||'';
  });

 back.onclick = ()=>location.href='cabinet.html';

 edit.onclick = ()=>{
   [name,description,address,city,map_link,vk_link,tg_link].forEach(el=>el.disabled=false);
   edit.style.display='none'; save.style.display='inline-block';
 };

 save.onclick = ()=>{
   const body={
     id:pid,name:name.value,description:description.value,address:address.value,
     city:city.value,map_link:map_link.value,vk_link:vk_link.value,tg_link:tg_link.value
   };
   fetch(`${api}/update_partner`,{
     method:'POST',headers:{'Content-Type':'application/json'},
     body:JSON.stringify(body)
   })
   .then(r=>r.json()).then(j=>{
      alert(j.status==='success'?'Данные сохранены':'Ошибка: '+j.message);
      location.reload();
   });
 };
</script>
</body></html>
