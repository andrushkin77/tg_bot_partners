<!DOCTYPE html>
<html lang="ru">
<head>
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø–∞—Ä—Ç–Ω–µ—Ä–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h2>–í–∞—à–∏ –∑–∞–∫–∞–∑—ã</h2>
    <div id="orders-container">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        function loadOrders() {
            const apiUrl = "https://3bjtq6-95-164-118-165.ru.tuna.am/api/orders?telegram_id=" + tg.initDataUnsafe.user.id;

            fetch(apiUrl, { method: "GET" })
            .then(response => response.json())
            .then(data => {
                console.log("üì• –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", data);  // –õ–æ–≥ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

                if (data.status !== "success") {
                    alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤: " + data.message);
                    return;
                }

                const orders = data.orders;
                const container = document.getElementById('orders-container');
                container.innerHTML = '';

                if (orders.length === 0) {
                    container.innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤.</p>';
                    return;
                }

                orders.forEach(order => {
                    const orderDiv = document.createElement('div');
                    orderDiv.innerHTML = `
                        <div style="border: 1px solid #ddd; padding: 10px; margin-bottom: 10px;">
                            <strong>–ó–∞–∫–∞–∑ #${order.id}</strong><br>
                            –û–ø–∏—Å–∞–Ω–∏–µ: ${order.description}<br>
                            –ü–æ–∂–µ–ª–∞–Ω–∏—è: ${order.wishes}<br>
                            –î–æ—Å—Ç–∞–≤–∫–∞: ${order.delivery_type} - ${order.delivery_time}<br>
                            –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${order.comment}<br><br>
                            <button onclick="respondToOrder(${order.id})">–û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è</button>
                        </div>
                    `;
                    container.appendChild(orderDiv);
                });
            })
            .catch(error => {
                console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ:", error);
                document.getElementById('orders-container').innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤.';
            });
        }

        function respondToOrder(orderId) {
            const price = prompt('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞:');
            const comment = prompt('–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):');

            const apiUrl = "https://3bjtq6-95-164-118-165.ru.tuna.am/api/respond";

            fetch(apiUrl, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    telegram_id: tg.initDataUnsafe.user.id,
                    order_id: orderId,
                    price: price,
                    comment: comment
                })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                loadOrders();
            })
            .catch(() => alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∫–ª–∏–∫–∞.'));
        }

        loadOrders();
    </script>
</body>
</html>
